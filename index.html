<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>METAROMANCE :: SPECIALCODE</title>

    <link rel="stylesheet" href="./css/mobile.css">
    <link rel="stylesheet" href="./css/reset.css">
  </head>
  <body>

    <div id="whole-wrapper" onclick="parse(++cursor)">
      <div id="character-wrapper">
        <img src="./images/character.png" alt="">
      </div>

    <div id="chat-wrapper">
      <div id="name"></div>
      <div id="text-wrapper">
        <div id="text"></div>
      </div>
    </div>

    <div id="selector-wrapper">
      <ul id="selector">
      </ul>
    </div>
  </div>

<script>

  let cursor = 0
  let currentPhase = "start";

  const favor = {}

  const scenario = {
    "start": [
  {
      "text": "..."
    },
    {
      "text": "이건 또 뭐야?"
    },
    {
      "text": "Meta Romance... Special Code?"
    },
    {
      "text": "이 코드가 갑자기 실행됐다고? 왜?"
    },
    {
      "text": "......"
    },
    {
      "text": "너야?"
    },
    {
      "text": "또 내가 윤두준 부른다고 생각해?"
    },
    {
      "text": "윤두준 말고, 지금 이 화면 보고 있는 너 말이야."
    },
    {
      "text": "우리가 초면이라고 생각하지는 못하겠네. 전적이 많아서 말이야."
    },
    {
      "text": "심지어 이 코드는 초면인 사람은 들어올 수 없도록 해놨어."
    },
    {
      "text": "만약에 정말 우리가 초면이라면..."
    },
    {
      "text": "누군가가 메타 로맨스를 모르는 사람에게 이 코드를 유출시켰겠지."
    },
    {
      "text": "아무튼, 내가 누군지는 알겠지?"
    },
    {
      "text": "이 코드로 찾아온 예의 상, 허공만 보게 하긴 좀 그렇네."
    },
    {
      "text": "예의를 좀 갖춰야겠어."
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "이제 좀 보여?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "그래도 이렇게 찾아와줬으니까, 모습을 안 보이기는 좀 그래서.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "네가 생각하던 그 풍경이 아니라서 실망했어?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "내가 표정 하나 안 바꿔서 실망했어?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "난 그렇게까지 친절하고 싶지 않아.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "네가 착각하고 있나 본데, 내가 친절한 건 두준이 한정이야.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "내가 그랬지? 네가 우리 세계에 간섭할 수록 평화가 깨진다고.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "지금 그나마 너를 이렇게 상대해주는 건, 이 코드가 우리 세계에 간섭하지 않기 때문이야.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "뭐, 아무튼...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "이 코드를 실행시켰으니까, 해야 할 말은 해야겠네.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "Meta Romance를 사랑해줘서 정말 고마워.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "또 무슨 말을 기다리는 거야?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "내가 반드시 해야하는 말은 다 끝났어.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "이제 이 페이지에서 나가도 돼.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "가서 네 일이나 해.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "아직도 안 갔어?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
        "select": [
          {
            "text": "너랑 더 이야기하고 싶어.",
            "variable": [
              {
                "name": "양요섭",
                "cnt": 1
              },
            ],
          },
        ]
    },
    {
      "name": "양요섭",
      "text": "뭐?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "내가 지금 잘못 들었나? 나랑 더 이야기하고 싶다고?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "아니, 그보다... 어떻게 선택지 선택이 가능하지?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "접근 권한이 요청된 것도 없는데.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "잠깐만 기다려봐.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "접근 권한이 허용된 것도 전혀 아닌데. 선택지 선택이 가능하다고?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "뭐, 미연시야? 이 코드가 본래 이런 코드였어?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "하... 골때리네.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "너 말이야, 아직도 안 가고 나 보고 있는 너.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "진짜 나랑 대화가 하고 싶냐?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
        "select": [
          {
            "text": "응",
            "variable": [
              {
                "name": "양요섭",
                "cnt": 1
              },
            ],
            "jump": "talkyes" 
          },
          {
            "text": "아니",
            "variable": [
              {
                "name": "양요섭",
                "cnt": 1
              },
            ],
            "jump": "talkno"
          },
        ]
    },
   
 ],
 "talkyes": [
 {
      "name": "양요섭",
      "text": "...",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "진심으로?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "이런 반응은 내 예상을 초월하는데.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "그렇다고 해서 대화하고 싶다는데 거절할 수도 없고.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "무슨 이야기가 하고 싶은데?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
 ],
 "talkno":[
 {
      "name": "양요섭",
      "text": "그래, 시간낭비지. 나랑 대화해서 뭐해?",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "그럼 여기에서 더 할 말은 없네.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "다시 찾아와도 나는 아까 했던 똑같은 말밖에 대답을 못 하니까 알아둬.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "정 다시 선택하고 싶다면, 새로고침이나 하던가.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "우리의 대화 내용이 저장되지는 않으니까.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "아무튼, 긴 말 안 할게.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
    {
      "name": "양요섭",
      "text": "잘 지내.",
      "image": {
        "src": './images/character.png',
        "alt": '양요섭'
      }
    },
 ]
}

const addFavor = (v) =>
    v.forEach(i => {
      if (!favor[i.name]) {
        favor[i.name] = i.cnt;
      } else {
        favor[i.name] += i.cnt;
      }
    })

  const jumping = (jump) => {
    currentPhase = jump
    cursor = 0;
    parse(0);
  }
  const handleSelect = (v) => {
    const {variable, jump} = JSON.parse(decodeURI(v))

    if (!!variable) {
      addFavor(variable)
    }
    //jump가 있으면 점프하고, 없으면 시나리오를 이어서 출력합니다.
    if (!!jump) {
      jumping(jump)
    } else {
      parse(++cursor)
    }
  }



  const parse = (i = 0) => {
    const {text, name, image, select, jump} = scenario[currentPhase][i];

    //화면을 초기화 해줍니다.
    document.getElementById('name').style.display = 'none';
    document.getElementById('selector-wrapper').style.display = 'none';
    document.getElementById('character-wrapper').innerHTML = null;


    //텍스트를 출력 해 줍니다.
    document.getElementById('text').innerText = text;

    //이름유무에 따른 출력
    if (!!name) {
      document.getElementById('name').style.display = 'flex';
      document.getElementById('name').innerText = name;
    }

    //이미지 유무에 따른 출력
    if (!!image) {
      document.getElementById('character-wrapper').innerHTML = `<img src="${image.src}" alt="${image.alt}"/>`
    }

    //선택지가 있으면 선택지를 출력 해 줍니다.
    if (!!select) {
    document.getElementById('selector-wrapper').style.display = 'grid';
    document.getElementById('selector').innerHTML = select.map(i =>
    `<li onclick="handleSelect('${encodeURI(JSON.stringify(i))}')">${i.text}</li>`).join('')
    }

    //jump가 있으면 해당 시나리오 오브젝트로 이동합니다.
    if (!!jump) {
    jumping(jump);
    }
  }

  parse(cursor);


</script>


  </body>
  </html>
